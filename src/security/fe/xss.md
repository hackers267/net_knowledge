{{#title web安全-XSS攻击}}
# XSS攻击

## 什么是XSS攻击

XSS(Cross-Site Scripting,跨站脚本攻击)是一种常见的网络安全漏洞，攻击者通过在目标网站中注入恶意脚本，当用户访问该网站时恶意脚本在用户的浏览器中执行，从而达到窃取用户信息、篡改页面内容、进行恶意操作等目的。

### 攻击方式

1. **存储型XSS**:
- 攻击者将恶意脚本存储在目标网站的数据库中。例如，在一个论坛中，攻击者发布一篇常有恶意脚本的帖子，当其他用户查看这个帖子时，浏览器会执行恶意脚本。
- 这种类型的攻击危害较大，因为恶意脚本可以道具存在于数据库中，影响大量用户。
- 示例：在一个博客网站上，攻击者在评论区输入"<script>stealUserData()</script>"。这个恶意脚本存储在数据库中。当其他用户浏览该博客及其评论时，可能导致用户的登录凭证等敏感信息被窃取。
2. **反射型XSS**:
- 攻击者构建一个包含恶意脚本的URL，诱使用户点击。当用户访问这个URL时，服务器将恶意脚本作为响应的一部分返回用户的浏览器，浏览器执行恶意脚本。
- 例如，攻击者发送一封包含恶意链接的电子邮件，用户点击链接后受到攻击。
- 示例：攻击者制作一个看似正常的链接，如"http://exmaple.com/search?query=<script>alter('XSS')</sciprt>",然后通过电子邮件、社交媒体等方式发送给受害者。当受害者点击这个链接时，浏览器会执行恶意脚本弹出"XSS"的提示框。
3. **DOM型XSS**:
- 攻击者通过修改页面的DOM结构来注入恶意脚本。这种攻击方式不需要服务器的参与，完全在客户端的浏览器中进行。
- 例如，一个网页通过JavaScript从URL参数中获取数据并显示在页面上，如果没有对参数进行正确的过滤和验证，攻击者可以构造恶意的URL参数，使页面执行恶意脚本。
- 示例：攻击者通过利用客户部当脚本(如JavaScript)中的漏洞，通过修改页面的DOM来注入恶意脚本。

### 可能造成的色害
1. **窃取用户信息**：
- 恶意脚本可以读取用户的登录凭证、个人信息、信用卡号等敏感数据，并将这些数据发送给攻击者。
- 例如，用户在受攻击的网站上登录银行账户，恶意脚本可以窃取用户的登录信息，导致资金被盗。
2. **篡改页面内容**:
- 攻击者可以修改页面的显示内容，误导用户进行错误的操作。
- 比如:将一个正规网站的支付页面篡改为指向攻击者控制的账户，欺骗用户进行转帐。
3. **进行恶意操作**:
- 恶意脚本可以在用户的浏览器中执行各种恶意操作，如发送垃圾邮件、下载恶意软件、发起DDoS（分布式拒绝服务)攻击等。

为了防止XSS攻击，网站开发都需要采取一系列的安全措施，如输入验证、输出编码、使用安全的API等。同时，用户也应该保持警惕，不改量点击不明来源的链接，不履新在不可信的网站上输入个人信息。

### 防范XSS攻击

1. **输入验证**:
- 对用户输入的数据进行严格的验证和过滤。可以使用白名单机制，只允许特定类型和格式的数据输入。
  - 例如，对一个用户评论功能，只允许输入字母、数字、常见标点符号等，禁止输入HTML标签和脚本代码。
  - 使用正则表达式或专门的输入验证库来确保输入的合法性。
- 对URL参数进行验证。当从URL中获取参数值时，检查参数的格式和内容是否符合预期。
  - 比如，确保参数是数字类型时，使用数字验证函数进行检查，防止恶意脚本通过URL参数传入。
2. **输出编码**
- 在可信度用户输入的数据显示到页面上时，进行HTML编码或转义。这样可以确保任何潜在的恶意脚本被转换为安全的文本，不会被浏览器执行。
  -例如，将`<script>`转换为`&lt;script&gt;`,将`"`转换为`&quot;`等。
  -大多数编程语言和Web框架都提供了输出编码的函数或工具，可以方便地进行安全输出。
- 对于富文本内容，可以使用专门的富文本编辑器和过滤库。这些工具可以在允文一定格式的HTML标签的同时，过滤把潜在的恶意脚本。
  - 比如，只允文特定的标签如`<p>`、`<b>`、`<i>`等，禁止`<script>`、`‹iframe>`等危险标签。
3. **设置HTTP安全头**
- 使用`Content-Security-Policy`(内容安全策略)头来限制页面可以加载的资源和执行的脚本。
  - 例如，可以设置只允许从特定的域名加载脚本和样式表，禁止内眹脚本和eval()函数的使用。
  - `Content=Security-Policy: default-src 'self'; script-src 'self' example.com; style-src 'self' exmaple`,这个策略表示默认情况下只允许从当前域名加载资源脚本只能从当前域名和`example.com`加载，样式表也同样如此。
4. **保持软件更新**
1. 及早更新Web应用程序所使用的框架、库和服务器软件。这些软件的开发者会不断修复安全漏洞，包括XSS相关的问题。
- 例如，更新React、Vue等前端框架，Django、Flash等后端框架，以及服务器软件如Apache、Nginx等
2. 关注安全公告和漏洞报告，了解最新的安全威胁和防范措施，及时采取相应行动。
